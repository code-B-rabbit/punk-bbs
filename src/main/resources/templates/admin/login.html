<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:fragment="head">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>后台管理</title>
    <meta name="description" content="">
    <link rel="shortcut icon" type="image/x-icon" href="../static/icon.png" th:href="|/icon.png|">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="../../static/vendor/bootstrap/css/bootstrap.min.css" th:href="@{/vendor/bootstrap/css/bootstrap.min.css}">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="../../static/vendor/font-awesome/css/font-awesome.min.css" th:href="@{/vendor/font-awesome/css/font-awesome.min.css}">
    <!-- Custom icon font-->
    <link rel="stylesheet" href="../../static/css/fontastic.css" th:href="@{/css/fontastic.css}">
    <!-- Google fonts - Open Sans-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
    <!-- Fancybox-->
    <link rel="stylesheet" href="../../static/vendor/@fancyapps/fancybox/jquery.fancybox.min.css" th:href="@{/css/fontastic.css}">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="../../static/css/style.default.css" id="theme-stylesheet" th:href="@{/css/style.default.css}">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="../../static/css/custom.css" th:href="@{/css/custom.css}">
    <!-- Favicon-->
    <link rel="shortcut icon" href="favicon.png">

    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>
<link rel="stylesheet"  th:href="@{/css/login.css}">

<body>
<div class="container">
    <div class="row justify-content-center" style="height: 500px">
        <div class="align-self-center">
            <script th:inline="javascript">
                var msg=[[${message}]];
                if(msg)
                {
                    alert(msg);          //修改回显
                }
            </script>
            <script>
                $(function () {
                    function getOrderList() {
                        //orderForm即是表单的ID
                        return false;
                    }
                    function request(data)
                    {
                        var defer = $.Deferred();
                        $.ajax({
                            url:"checkUser",
                            method:"post",
                            data:data,
                            success:function (dataStr) {
                                if(dataStr.message==true){
                                    if(dataStr.admin==true){
                                        location.href="/admin/articleList";
                                    }else{
                                        location.href="/userAdmin/articleList";
                                    }
                                }else if(dataStr.message==false){
                                    alert("用户名或密码错误");
                                }else{
                                    alert("短时间内登陆失败次数过多,请过段时间再试");
                                }
                            }
                        });
                        return defer.promise();
                    }

                    function refresh(){
                        $('img#imgs').trigger("click");
                    }


                    $('form#login').submit(function () {

                        $.post("/valid",{
                                tryCode:$("#verCode").val()
                            },
                            function(data) {
                                if(data.error)
                                {
                                    alert(data.info);
                                    $('img#imgs').trigger("click");
                                    return false;
                                }else{
                                    var data=$("form#login").serialize();
                                    if(data.name||data.password){
                                        alert("用户名或密码不能为空!");
                                        return false;
                                    }else
                                    {
                                        request(data);
                                        return false;
                                    }
                                }
                            }
                        );
                        return false;
                    })
                })
            </script>
            <div class="card" target="iframe">
                <div class="card-header">后台管理登录</div>
                <div class="card-body">
                    <span class="font-weight-bold">(部分手机自带浏览器可能会无法正常登录,换成其他浏览器即可)</span>
                    <form method="post" id="login" target="_blank" action="#">
                        <div class="form-group">
                            <input type="name" name="name" class="form-control username1" id="exampleInputEmail1" placeholder="请输入您的用户名">
                        </div>
                        <div class="input-group mb-3">
                            <input type="password" id="exampleInputPassword1" name="password" class="form-control userPassword1" placeholder="请输入密码" aria-label="Recipient's username" aria-describedby="button-addon2"/>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="button-addon2">显示密码</button>
                            </div>
                        </div>
                        <div class="input-group mb-3">
                            <input type="text" id="verCode"  class="form-control userPassword1" placeholder="请输入验证码" aria-label="Recipient's username" aria-describedby="button-addon2"/>
                            <div class="input-group-append" >
                                <img id="imgs" onclick="this.src='/defaultKaptcha?d=' + new Date()*1" src="/defaultKaptcha"   aria-label="Recipient's username" aria-describedby="button-addon2"/>
                            </div>
                        </div>
                        <div class="form-check">
                            <btn onclick="refresh()" class="btn-link float-right">验证码看不清楚?换一张</btn>
                        </div>
                        <br>
                        <button  type="submit" class="btn btn-block btn-info btn-default">登录</button>
                        <a type="button" href="/articles" class="btn btn-block btn-light btn-default">返回首页</a>
                        <iframe id="iframe" name="iframe" style="display:none;"></iframe>
                        <script>
                            $(function () {
                                hide=true;        //全局的是否隐藏的变量
                                $("#button-addon2").click(
                                    function () {
                                        hide=!hide;
                                        if(hide==true)
                                        {
                                            $('#exampleInputPassword1').attr('type','password');
                                            $(this).text("点我显示");
                                        }else
                                        {
                                            $('#exampleInputPassword1').attr('type','text');
                                            $(this).text("点我隐藏");
                                        }
                                    }
                                );
                            })
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>